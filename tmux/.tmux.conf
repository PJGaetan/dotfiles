unbind-key C-b
set -g prefix2 C-q; bind-key C-q send-prefix -2

bind r source-file ~/.tmux.conf
setw -g mode-keys vi

# Vim like split windows
#bind v split-window -h
#bind n split-window -v

bind C-k display-popup -E "\
    tmux list-sessions -F '#{?session_attached,,#{session_name}}' |\
    sed '/^$/d' |\
    fzf --reverse -m --header=kill-session --preview 'tmux capture-pane -pt {}' |\
    xargs -I {} tmux kill-session -t {}"

bind C-j display-popup -E "\
    ls ~/Desktop/repo-qare |\
    fzf --reverse --header projects |\
    xargs -I % tmux new-session -d -P -F '#{?session_attached,,#{session_name}}' -s % -c ~/Desktop/repo-qare/% |\
    xargs -I % tmux switch-client -t %"

bind C-t display-popup -E "\
    ls ~/Documents/Notes |\
    fzf --reverse --header notes |\
    xargs -I % tmux new-session -d -P -F '#{?session_attached,,#{session_name}}' -s % -c ~/Documents/Notes/% ' vim ~/Documents/Notes/%'|\
    xargs -I % tmux switch-client -t %"

bind t command-prompt "\
    new-session -d -F '#{?session_attached,,#{session_name}}' -s %1 -c ~/Documents/Notes/ ' vim ~/Documents/Notes/%1' |\
    xargs -I % tmux switch-client -t %"

# Copy mode like vim
bind P paste-buffer
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-selection
bind-key -T copy-mode-vi r send-keys -X rectangle-toggle

# tpm plugin
set -g @plugin 'tmux-plugins/tpm'

# Dracula theme status line
set -g @plugin 'dracula/tmux'
set -g @dracula-show-location false
set -g @dracula-plugins "battery git time"
set -g @dracula-show-timezone false
set -g @dracula-day-month true
set -g @dracula-military-time true
set -g @dracula-git-no-untracked-files true

# vim-tmux
# Smart pane switching with awareness of Vim splits.
# See: https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h' 'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j' 'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k' 'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l' 'select-pane -R'
tmux_version='$(tmux -V | sed -En "s/^tmux ([0-9]+(.[0-9]+)?).*/\1/p")'
if-shell -b '[ "$(echo "$tmux_version < 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\'  'select-pane -l'"
if-shell -b '[ "$(echo "$tmux_version >= 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\\\'  'select-pane -l'"
bind-key -n 'C-Space' if-shell "$is_vim" 'send-keys C-Space' 'select-pane -t:.+'

bind-key -T copy-mode-vi 'C-h' select-pane -L
bind-key -T copy-mode-vi 'C-j' select-pane -D
bind-key -T copy-mode-vi 'C-k' select-pane -U
bind-key -T copy-mode-vi 'C-l' select-pane -R
bind-key -T copy-mode-vi 'C-\' select-pane -l
bind-key -T copy-mode-vi 'C-Space' select-pane -t:.+

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
